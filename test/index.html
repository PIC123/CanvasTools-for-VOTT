<!doctype html>
<html>

<head>
    <link rel="stylesheet" href="css/index.css" />
    <title>CanvasTools Demo</title>
</head>

<body>
    <div id="ctZone">
        <svg id="svgHost">
            <defs>
                <filter id="black-glow">
                    <feGaussianBlur in="SourceAlpha" stdDeviation="2" />
                        <feOffset dx="0" dy="0" result="offsetblur" />
                        <feComponentTransfer>
                        <feFuncA type="linear" slope="0.8" />
                    </feComponentTransfer>
                    <feMerge>
                        <feMergeNode />
                        <feMergeNode in="SourceGraphic" />
                    </feMerge>
                </filter>
            </defs>
        </svg>
    </div>

    <div>Some text <input type="text" /></div>
</body>
<script src="./js/ct.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", (e) => {
        var ct = CanvasTools.CanvasTools;
        let svgHost = document.getElementById("svgHost");

        let selector = new ct.Selection.AreaSelector(svgHost,
            function onselectionBegin() {
                // no arguments, just notification
            },
            function onselectionEnd(x1, y1, x2, y2) {
                // console.log("Selection: " + x1 + ": " + y1 + "; " + x2 + ": " + y2);
                // build new tag (titles + color hue value)
                var primaryTag = new ct.Base.Tags.Tag(
                    (Math.random() > 0.5) ? "Awesome" : "Brilliante!",
                    Math.floor(Math.random() * 360.0));
                var secondaryTag = new ct.Base.Tags.Tag(
                    (Math.random() > 0.5) ? "Yes" : "No",
                    Math.floor(Math.random() * 360.0));
                var ternaryTag = new ct.Base.Tags.Tag(
                    (Math.random() > 0.5) ? "one" : "two",
                    Math.floor(Math.random() * 360.0));
                var tags = new ct.Base.Tags.TagsDescriptor(primaryTag, [secondaryTag, ternaryTag]);
                // create region using regionsmanager
                rm.addRegion((regionId++).toString(), { x: x1, y: y1 }, { x: x2, y: y2 }, tags);
            });

        rm.onManipulationEnd = function () {
            selector.enable();
        };
        rm.onManipulationBegin = function () {
        selector.disable();
    };

        // Upload background image for selection 
        let imageCnvs = document.getElementById("sourceImageCnvs");
        let imagePath = "./../images/background-cat.jpg";
        let image = new Image();
        image.addEventListener("load", (e) => {
            // Create buffer
            let buffCnvs = document.createElement("canvas");
            let context = buffCnvs.getContext("2d");
            buffCnvs.width = e.target.width;
            buffCnvs.height = e.target.height;
            // Fill buffer
            context.drawImage(e.target, 0, 0, buffCnvs.width, buffCnvs.height);

            let filter = new ct.Filter.FilterPipeline();
            //filter.addFilter(ct.Filter.InvertFilter);
            //filter.addFilter(ct.Filter.GrayscaleFilter);
            filter.applyToCanvas(buffCnvs).then((bcnvs) => {
                // Copy buffer to the canvas on screen
                imageCnvs.width = bcnvs.width;
                imageCnvs.height = bcnvs.height;
                let imgContext = imageCnvs.getContext("2d");
                imgContext.drawImage(bcnvs, 0, 0, bcnvs.width, bcnvs.height);
            });
        });
        image.src = imagePath;
    });
</script>

</html>